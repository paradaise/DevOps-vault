
**–ß—Ç–æ —ç—Ç–æ?**  
–°–∏—Å—Ç–µ–º–∞ –¥–ª—è¬†**—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –∞–Ω–∞–ª–∏–∑–∞ –ª–æ–≥–æ–≤**¬†(–∞–Ω–∞–ª–æ–≥ ELK, –Ω–æ –ø—Ä–æ—â–µ –∏ –¥–µ—à–µ–≤–ª–µ).

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç?**

1. –ò–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ª–æ–≥–æ–≤ (–Ω–µ —Å–∞–º–∏ –ª–æ–≥–∏ ‚Üí —ç–∫–æ–Ω–æ–º–∏—è –º–µ—Å—Ç–∞).
    
2. –ü–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–∫–∞—Ç—å –ª–æ–≥–∏ —á–µ—Ä–µ–∑¬†**LogQL**¬†(–∫–∞–∫ SQL –¥–ª—è –ª–æ–≥–æ–≤).
    

**–ó–∞—á–µ–º?**

- –ê–≥—Ä–µ–≥–∞—Ü–∏—è –ª–æ–≥–æ–≤ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤.
    
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Grafana (–ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ —Ä—è–¥–æ–º —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏).
    

**–ü—Ä–∏–º–µ—Ä LogQL**:

`{app="nginx"} |= "error"`


``` yaml
auth_enabled: false #–û—Ç–∫–ª—é—á–µ–Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è, –Ω–µ–±–µ–∑–æ–ø–∞—Å—Ç–Ω–æ –¥–ª—è –ø—Ä–æ–¥–∞!

  

server:

http_listen_port: 3100 #–ü–æ—Ä—Ç –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º —Å–ª—É—à–∞–µ—Ç Loki

  
  

ingester:

lifecucler:

ring:

kvstore:

store: inmemory # —Ö—Ä–∞–Ω–∏—Ç –∫–æ–ª—å—Ü–æ –∏–Ω—Ç–≥–µ—Å—Ç–µ—Ä–æ–≤ –≤ –ø–∞–º—è—Ç–∏ (–Ω–µ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–∞–Ω–∞).

replication_factor: 1 #–ö–æ–ª-–≤–æ —Ä–µ–ø–ª–∏–∫ –¥–∞–Ω–Ω—ã—Ö( 1 - –Ω–µ—Ç —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏).

chunk_idle_period: 5m # –ö–∞–∫ –±—ã—Å—Ç—Ä–æ —Ñ–ª–∞—à–∏—Ç —á–∞–Ω–∫–∏ –ø–æ—Å–ª–µ —Ñ–ª–∞—à–∞.

chunk_retain_period: 30s # –ö–∞–∫ –¥–æ–ª–≥–æ —Ö—Ä–∞–Ω–∏—Ç—å —á–∞–Ω–∫–∏ –ø–æ—Å–ª–µ —Ñ–ª–∞—à–∞.

max_chunk_age: 1h # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Å—Ç —á–∞–Ω–∫–∞ –ø–µ—Ä–µ–¥ —Ñ–ª–µ—à–µ–º.

  
  

schema_config:

configs:

- from: 2020-10-24 #–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –¥–µ–π—Å—Ç–≤–∏—è —Å—Ö–µ–º—ã.

store: boltdb-shipper #–ò—Å–ø–æ–ª—å–∑—É–µ—Ç BoltDB –¥–ª—è –∏–Ω–¥–µ–∫—Å–æ–≤.

object_store: filesystem #—Ö—Ä–∞–Ω–∏—Ç —á–∞–Ω–∫–∏ –Ω–∞ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ.

schema: v11 # –í–µ—Ä—Å–∏—è —Å—Ö–µ–º—ã Loki

index:

prefix: index_ #–ü—Ä–µ—Ñ–∏–∫—Å –¥–ª—è –∏–Ω–¥–µ–∫—Å–æ–≤

period: 24h #–ü–µ—Ä–∏–æ–¥ —Ä–æ—Ç–∞—Ü–∏–∏ –∏–Ω–¥–µ–∫—Å–æ–≤

  

storage_config:

boltdb_shipper:

active_index_directory: /loki/index #–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤

cache_location: /loki/boltdb-cache #–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –∫–µ—à–∞ BoltDB

filesystem:

directory: /loki/chunks #–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —á–∞–Ω–∫–æ–≤ –ª–æ–≥–æ–≤.

  

limits_config:

retention_period: 168h #–•—Ä–∞–Ω–∏—Ç—å –ª–æ–≥–∏

allow_structured_metadata: false #–ó–∞–ø—Ä–µ—â–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ

  
  

table_manager:

retention_deletes_enabled: true #–í–∫–ª—é—á–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö

retention_period: 168h # –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç `retention_period` –≤ `limits_config`

  
  

query_scheduler:

max_outstanding_requests_per_tenant: 2048 # –õ–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ —Ç–µ–Ω–∞–Ω—Ç.

  

common:

path_prefix: /tmp/loki # –ë–∞–∑–æ–≤—ã–π –ø—É—Ç—å –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ ( –Ω–µ –¥–ª—è –ø—Ä–æ–¥–∞!)
```

### **. –ß–∞–Ω–∫–∏ (Chunks) ‚Äì –∫—É—Å–∫–∏ –ª–æ–≥–æ–≤**

üîπ¬†**–ß—Ç–æ —ç—Ç–æ?**

- –õ–æ–≥–∏ –≤ Loki –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –∫–∞–∫ –æ–¥–Ω–∞ –±–æ–ª—å—à–∞—è –∫—É—á–∞, –∞ —Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è –Ω–∞¬†**—á–∞–Ω–∫–∏**¬†(–∫—É—Å–æ—á–∫–∏).
    
- –ö–∞–∂–¥—ã–π —á–∞–Ω–∫ ‚Äì —ç—Ç–æ –Ω–∞–±–æ—Ä –∑–∞–ø–∏—Å–µ–π –ª–æ–≥–æ–≤ –∑–∞ –Ω–µ–±–æ–ª—å—à–æ–π –ø–µ—Ä–∏–æ–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ª–æ–≥–∏ –∑–∞ 5 –º–∏–Ω—É—Ç).
    

üîπ¬†**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç?**

- –ö–æ–≥–¥–∞ Loki –ø–æ–ª—É—á–∞–µ—Ç –ª–æ–≥–∏, –æ–Ω —Å–Ω–∞—á–∞–ª–∞ –ø–∏—à–µ—Ç –∏—Ö –≤¬†**–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—É—é –ø–∞–º—è—Ç—å**¬†(—á—Ç–æ–±—ã –±—ã—Å—Ç—Ä–æ).
    
- –ï—Å–ª–∏ –ª–æ–≥–∏ –ø–µ—Ä–µ—Å—Ç–∞—é—Ç –ø–æ—Å—Ç—É–ø–∞—Ç—å –Ω–∞¬†**5 –º–∏–Ω—É—Ç**¬†(`chunk_idle_period: 5m`), Loki¬†**"—Ñ–ª–∞—à–∏—Ç"**¬†(—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç) —á–∞–Ω–∫ –Ω–∞ –¥–∏—Å–∫.
    
- –ï—Å–ª–∏ —á–∞–Ω–∫ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å–ª–∏—à–∫–æ–º —Å—Ç–∞—Ä—ã–º (**1 —á–∞—Å**,¬†`max_chunk_age: 1h`), Loki —Ç–æ–∂–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –µ–≥–æ, –¥–∞–∂–µ –µ—Å–ª–∏ –ª–æ–≥–∏ –µ—â—ë –ø–∏—à—É—Ç—Å—è.
    

üëâ¬†**–ü—Ä–æ—â–µ:**

- **–ß–∞–Ω–∫ = –±–ª–æ–∫ –ª–æ–≥–æ–≤**¬†(–∫–∞–∫ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤ –∫–Ω–∏–≥–µ).
    
- **–§–ª–∞—à–∏—Ç—å—Å—è = —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è —Å –ø–∞–º—è—Ç–∏ –Ω–∞ –¥–∏—Å–∫**¬†(—á—Ç–æ–±—ã –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å)



### **2. –ò–Ω–≥–µ—Å—Ç–µ—Ä—ã (Ingesters) ‚Äì "–ø–æ–∂–∏—Ä–∞—Ç–µ–ª–∏" –ª–æ–≥–æ–≤**

üîπ¬†**–ß—Ç–æ —ç—Ç–æ?**

- –≠—Ç–æ —Å–µ—Ä–≤–∏—Å—ã Loki, –∫–æ—Ç–æ—Ä—ã–µ¬†**–ø—Ä–∏–Ω–∏–º–∞—é—Ç –ª–æ–≥–∏**¬†–æ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –∏ —Å–∫–ª–∞–¥—ã–≤–∞—é—Ç –∏—Ö –≤ —á–∞–Ω–∫–∏.
    

üîπ¬†**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç?**

1. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —à–ª—ë—Ç –ª–æ–≥–∏ –≤ Loki ‚Üí –ø–æ–ø–∞–¥–∞—é—Ç –≤¬†**–∏–Ω–≥–µ—Å—Ç–µ—Ä**.
    
2. –ò–Ω–≥–µ—Å—Ç–µ—Ä –¥–µ—Ä–∂–∏—Ç —á–∞–Ω–∫–∏ –≤¬†**–æ–ø–µ—Ä–∞—Ç–∏–≤–∫–µ**¬†(–¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏).
    
3. –ï—Å–ª–∏ —á–∞–Ω–∫ "–ø—Ä–æ—Å—Ç–∞–∏–≤–∞–µ—Ç" (5 –º–∏–Ω—É—Ç –Ω–µ—Ç –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π), –∏–Ω–≥–µ—Å—Ç–µ—Ä —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –µ–≥–æ –≤¬†**—Ö—Ä–∞–Ω–∏–ª–∏—â–µ**¬†(–Ω–∞ –¥–∏—Å–∫).
    

üëâ¬†**–ü—Ä–æ—â–µ:**

- **–ò–Ω–≥–µ—Å—Ç–µ—Ä = –ø–æ—á—Ç–∞–ª—å–æ–Ω**, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–∏—Å—å–º–∞ (–ª–æ–≥–∏) –∏ —Å–∫–ª–∞–¥—ã–≤–∞–µ—Ç –∏—Ö –≤ –ø–∞—á–∫–∏ (—á–∞–Ω–∫–∏).

### **. –ö–æ–ª—å—Ü–æ (Ring) ‚Äì —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏–Ω–≥–µ—Å—Ç–µ—Ä–æ–≤**

üîπ¬†**–ß—Ç–æ —ç—Ç–æ?**

- Loki –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤¬†**—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ**¬†(–º–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–æ–≤).
    
- **–ö–æ–ª—å—Ü–æ (Ring)**¬†‚Äì —ç—Ç–æ —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏–Ω–≥–µ—Å—Ç–µ—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Å–µ–π—á–∞—Å —Ä–∞–±–æ—Ç–∞—é—Ç.
    

üîπ¬†**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç?**

- –ö–æ–≥–¥–∞ Loki –ø–æ–ª—É—á–∞–µ—Ç –ª–æ–≥–∏, –æ–Ω —Å–º–æ—Ç—Ä–∏—Ç –≤¬†**–∫–æ–ª—å—Ü–æ**¬†–∏ –≤—ã–±–∏—Ä–∞–µ—Ç, –∫–∞–∫–æ–º—É –∏–Ω–≥–µ—Å—Ç–µ—Ä—É –∏—Ö –æ—Ç–ø—Ä–∞–≤–∏—Ç—å.
    

üëâ¬†**–ü—Ä–æ—â–µ:**

- **–ö–æ–ª—å—Ü–æ = —Ç–µ–ª–µ—Ñ–æ–Ω–Ω–∞—è –∫–Ω–∏–≥–∞**¬†—Å –Ω–æ–º–µ—Ä–∞–º–∏ –≤—Å–µ—Ö –ø–æ—á—Ç–∞–ª—å–æ–Ω–æ–≤ (–∏–Ω–≥–µ—Å—Ç–µ—Ä–æ–≤).
    
- –ï—Å–ª–∏ –∫–Ω–∏–≥—É –Ω–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å (`inmemory`), –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ Loki –Ω–µ –±—É–¥–µ—Ç –∑–Ω–∞—Ç—å, –∫—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –ª–æ–≥–∏.

### **4. –ö–∞–∫ —ç—Ç–æ –≤—Å—ë —Å–≤—è–∑–∞–Ω–æ?**

1. **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**¬†‚Üí —à–ª—ë—Ç –ª–æ–≥–∏ –≤¬†**Loki**.
    
2. **Loki**¬†—Å–º–æ—Ç—Ä–∏—Ç –≤¬†**–∫–æ–ª—å—Ü–æ**¬†–∏ –≤—ã–±–∏—Ä–∞–µ—Ç¬†**–∏–Ω–≥–µ—Å—Ç–µ—Ä**.
    
3. **–ò–Ω–≥–µ—Å—Ç–µ—Ä**¬†—Å–∫–ª–∞–¥—ã–≤–∞–µ—Ç –ª–æ–≥–∏ –≤¬†**—á–∞–Ω–∫**¬†(–ø–æ–∫–∞ –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–∫–µ).
    
4. –ï—Å–ª–∏ —á–∞–Ω–∫¬†**5 –º–∏–Ω—É—Ç –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è**, –æ–Ω¬†**—Ñ–ª–∞—à–∏—Ç—Å—è**¬†(—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞ –¥–∏—Å–∫).
    
5. –ß–µ—Ä–µ–∑¬†**24 —á–∞—Å–∞**¬†(`period: 24h`) Loki –æ–±–Ω–æ–≤–ª—è–µ—Ç¬†**–∏–Ω–¥–µ–∫—Å—ã**¬†(—á—Ç–æ–±—ã –±—ã—Å—Ç—Ä–æ –∏—Å–∫–∞—Ç—å –ª–æ–≥–∏).
    
6. –ß–µ—Ä–µ–∑¬†**7 –¥–Ω–µ–π**¬†(`retention_period: 168h`) —Å—Ç–∞—Ä—ã–µ –ª–æ–≥–∏ —É–¥–∞–ª—è—é—Ç—Å—è.